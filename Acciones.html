<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Mercado Financiero</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --text-color: #1f2937;
            --light-bg: #f9fafb;
            --dark-bg: #111827;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .home-button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .home-button:hover {
            background-color: var(--secondary-color);
        }
        
        .home-icon {
            width: 16px;
            height: 16px;
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #6b7280;
            max-width: 800px;
            margin-bottom: 30px;
        }
        
        .search-section {
            background-color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }
        
        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #d1d5db;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }
        
        .search-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .search-button:hover {
            background-color: var(--secondary-color);
        }
        
        .popular-symbols {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .symbol-tag {
            background-color: #e5e7eb;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .symbol-tag:hover {
            background-color: #d1d5db;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stock-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            display: none;
        }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stock-name {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .stock-symbol {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 5px;
        }
        
        .stock-price {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .stock-change {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
            font-weight: 600;
        }
        
        .positive {
            color: var(--success-color);
        }
        
        .negative {
            color: var(--danger-color);
        }
        
        .stock-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        .detail-value {
            font-weight: 600;
            margin-top: 2px;
        }
        
        .chart-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            display: none;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .time-periods {
            display: flex;
            gap: 10px;
        }
        
        .period-button {
            background-color: #e5e7eb;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .period-button.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .loader {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .error-message {
            display: none;
            color: var(--danger-color);
            text-align: center;
            padding: 20px;
            background-color: #fee2e2;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .comparison-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            display: none;
        }
        
        .comparison-header {
            margin-bottom: 20px;
        }
        
        .comparison-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .comparison-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .comparison-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .comparison-button:hover {
            background-color: var(--secondary-color);
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .comparison-inputs {
                grid-template-columns: 1fr;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .time-periods {
                margin-top: 10px;
                flex-wrap: wrap;
                justify-content: flex-start;
            }
            
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Dashboard de Mercado Financiero</h1>
            </div>
            <a href="Index.html">
                <button class="home-button">
                    <svg class="home-icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                    </svg>
                    Inicio
                </button>
            </a>
        </header>
        
        <p class="subtitle">Obtén información actualizada sobre mercados financieros. Ingresa el símbolo de una acción para ver su precio actual, gráficos y métricas clave.</p>
        
        <section class="search-section">
            <div class="search-container">
                <input type="text" id="stockSymbol" class="search-input" placeholder="Ingresa el símbolo de la acción (ej: AAPL, MSFT, AMZN)">
                <button id="fetchData" class="search-button">Buscar Datos</button>
            </div>
            <div>
                <p>Símbolos populares:</p>
                <div class="popular-symbols">
                    <span class="symbol-tag" data-symbol="AAPL">AAPL</span>
                    <span class="symbol-tag" data-symbol="MSFT">MSFT</span>
                    <span class="symbol-tag" data-symbol="GOOGL">GOOGL</span>
                    <span class="symbol-tag" data-symbol="AMZN">AMZN</span>
                    <span class="symbol-tag" data-symbol="TSLA">TSLA</span>
                    <span class="symbol-tag" data-symbol="META">META</span>
                </div>
            </div>
        </section>
        
        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p>Cargando datos...</p>
        </div>
        
        <div class="error-message" id="errorMessage">
            <p>No se pudieron cargar los datos. Por favor, verifica el símbolo e intenta nuevamente.</p>
        </div>
        
        <div class="dashboard">
            <div class="stock-card" id="stockData">
                <div class="stock-header">
                    <div>
                        <div class="stock-name">Nombre de la Empresa</div>
                        <div class="stock-symbol">SÍMBOLO</div>
                    </div>
                    <div>
                        <div class="stock-price">$0.00</div>
                        <div class="stock-change positive">+0.00 (+0.00%)</div>
                    </div>
                </div>
                <div class="stock-details">
                    <div class="detail-item">
                        <span class="detail-label">Apertura</span>
                        <span class="detail-value" id="openPrice">$0.00</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Máximo</span>
                        <span class="detail-value" id="highPrice">$0.00</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Mínimo</span>
                        <span class="detail-value" id="lowPrice">$0.00</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Volumen</span>
                        <span class="detail-value" id="volume">0</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Capitalización</span>
                        <span class="detail-value" id="marketCap">$0.00B</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">P/E Ratio</span>
                        <span class="detail-value" id="peRatio">0.00</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chart-container" id="chartContainer">
            <div class="chart-header">
                <h2 class="chart-title">Rendimiento Histórico</h2>
                <div class="time-periods">
                    <button class="period-button active" data-period="1d">1D</button>
                    <button class="period-button" data-period="1w">1S</button>
                    <button class="period-button" data-period="1m">1M</button>
                    <button class="period-button" data-period="3m">3M</button>
                    <button class="period-button" data-period="1y">1A</button>
                </div>
            </div>
            <canvas id="stockChart" width="400" height="250"></canvas>
        </div>
        
        <section class="comparison-section" id="comparisonSection">
            <div class="comparison-header">
                <h2 class="comparison-title">Comparar Acciones</h2>
                <p>Compara el rendimiento de dos acciones diferentes en el mismo gráfico</p>
            </div>
            <div class="comparison-inputs">
                <input type="text" id="comparisonSymbol1" class="search-input" placeholder="Primer símbolo (ej: AAPL)">
                <input type="text" id="comparisonSymbol2" class="search-input" placeholder="Segundo símbolo (ej: MSFT)">
                <button id="compareStocks" class="comparison-button">Comparar</button>
            </div>
            <canvas id="comparisonChart" width="400" height="250"></canvas>
        </section>
    </div>

    <script>
        // Variables globales
        let stockChart = null;
        let comparisonChart = null;
        let currentPeriod = '1d';
        
        // Elementos DOM
        const stockSymbolInput = document.getElementById('stockSymbol');
        const fetchDataButton = document.getElementById('fetchData');
        const stockDataElement = document.getElementById('stockData');
        const chartContainer = document.getElementById('chartContainer');
        const comparisonSection = document.getElementById('comparisonSection');
        const loader = document.getElementById('loader');
        const errorMessage = document.getElementById('errorMessage');
        const compareButton = document.getElementById('compareStocks');
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Botón principal de búsqueda
            fetchDataButton.addEventListener('click', function() {
                fetchStockData(stockSymbolInput.value.trim().toUpperCase());
            });
            
            // Presionar Enter en el campo de búsqueda
            stockSymbolInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    fetchStockData(this.value.trim().toUpperCase());
                }
            });
            
            // Símbolos populares
            document.querySelectorAll('.symbol-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    const symbol = this.getAttribute('data-symbol');
                    stockSymbolInput.value = symbol;
                    fetchStockData(symbol);
                });
            });
            
            // Botones de período de tiempo
            document.querySelectorAll('.period-button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.period-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    currentPeriod = this.getAttribute('data-period');
                    
                    // Actualizar el gráfico con el nuevo período
                    if (stockSymbolInput.value) {
                        updateChart(stockSymbolInput.value, currentPeriod);
                    }
                });
            });
            
            // Comparación de acciones
            compareButton.addEventListener('click', function() {
                const symbol1 = document.getElementById('comparisonSymbol1').value.trim().toUpperCase();
                const symbol2 = document.getElementById('comparisonSymbol2').value.trim().toUpperCase();
                
                if (symbol1 && symbol2) {
                    compareStocks(symbol1, symbol2);
                }
            });
        });
        
        // Función para obtener datos de la acción
        async function fetchStockData(symbol) {
            if (!symbol) {
                showError('Por favor ingresa un símbolo válido');
                return;
            }
            
            showLoader();
            hideError();
            
            try {
                // Simulamos una llamada a API (en un caso real, aquí iría tu llamada a la API financiera)
                const response = await simulateApiCall(symbol);
                
                if (response.error) {
                    showError(response.error);
                    return;
                }
                
                // Actualizar los datos de la acción
                updateStockCard(response);
                
                // Mostrar y actualizar el gráfico
                chartContainer.style.display = 'block';
                updateChart(symbol, currentPeriod);
                
                // Mostrar sección de comparación
                comparisonSection.style.display = 'block';
                
                // Cargar datos adicionales si estuvieran disponibles
                loadAdditionalData(symbol);
                
            } catch (error) {
                showError('Error al obtener datos: ' + error.message);
            } finally {
                hideLoader();
            }
        }
        
        // Función para actualizar la tarjeta de la acción
        function updateStockCard(data) {
            stockDataElement.style.display = 'block';
            
            // Actualizar la información básica
            stockDataElement.querySelector('.stock-name').textContent = data.companyName;
            stockDataElement.querySelector('.stock-symbol').textContent = data.symbol;
            stockDataElement.querySelector('.stock-price').textContent = `$${data.price.toFixed(2)}`;
            
            // Actualizar el cambio de precio
            const changeElement = stockDataElement.querySelector('.stock-change');
            const change = data.change;
            const changePercent = data.changePercent;
            
            if (change >= 0) {
                changeElement.className = 'stock-change positive';
                changeElement.textContent = `+${change.toFixed(2)} (+${changePercent.toFixed(2)}%)`;
            } else {
                changeElement.className = 'stock-change negative';
                changeElement.textContent = `${change.toFixed(2)} (${changePercent.toFixed(2)}%)`;
            }
            
            // Actualizar detalles
            document.getElementById('openPrice').textContent = `$${data.open.toFixed(2)}`;
            document.getElementById('highPrice').textContent = `$${data.high.toFixed(2)}`;
            document.getElementById('lowPrice').textContent = `$${data.low.toFixed(2)}`;
            document.getElementById('volume').textContent = formatNumber(data.volume);
            document.getElementById('marketCap').textContent = formatMarketCap(data.marketCap);
            document.getElementById('peRatio').textContent = data.peRatio.toFixed(2);
        }
        
        // Función para actualizar el gráfico
        function updateChart(symbol, period) {
            // Generar datos para el gráfico según el período seleccionado
            const chartData = generateChartData(period);
            
            const ctx = document.getElementById('stockChart').getContext('2d');
            
            // Destruir gráfico existente si hay uno
            if (stockChart) {
                stockChart.destroy();
            }
            
            // Crear nuevo gráfico
            stockChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: symbol,
                        data: chartData.prices,
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderColor: 'rgba(37, 99, 235, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(37, 99, 235, 1)',
                        pointRadius: 2,
                        pointHoverRadius: 5,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.raw.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
        
        // Función para comparar dos acciones
        function compareStocks(symbol1, symbol2) {
            // Generar datos para ambos símbolos
            const data1 = generateChartData('1m');
            const data2 = generateChartData('1m', 0.8); // Segundo conjunto con variación
            
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            // Destruir gráfico existente si hay uno
            if (comparisonChart) {
                comparisonChart.destroy();
            }
            
            // Crear nuevo gráfico de comparación
            comparisonChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data1.labels,
                    datasets: [
                        {
                            label: symbol1,
                            data: data1.prices,
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderColor: 'rgba(37, 99, 235, 1)',
                            borderWidth: 2,
                            pointRadius: 1,
                            tension: 0.4
                        },
                        {
                            label: symbol2,
                            data: data2.prices,
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 2,
                            pointRadius: 1,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
        
        // Función para cargar datos adicionales (podría extenderse en implementación real)
        function loadAdditionalData(symbol) {
            // Aquí se podrían cargar noticias, métricas financieras adicionales, etc.
            console.log(`Cargando datos adicionales para ${symbol}`);
        }
        
        // Funciones auxiliares
        function showLoader() {
            loader.style.display = 'block';
        }
        
        function hideLoader() {
            loader.style.display = 'none';
        }
        
        function showError(message) {
            errorMessage.style.display = 'block';
            errorMessage.querySelector('p').textContent = message;
            stockDataElement.style.display = 'none';
            chartContainer.style.display = 'none';
        }
        
        function hideError() {
            errorMessage.style.display = 'none';
        }
        
        function formatNumber(num) {
            return new Intl.NumberFormat().format(num);
        }
        
        function formatMarketCap(marketCap) {
            if (marketCap >= 1e12) {
                return `$${(marketCap / 1e12).toFixed(2)}T`;
            } else if (marketCap >= 1e9) {
                return `$${(marketCap / 1e9).toFixed(2)}B`;
            } else if (marketCap >= 1e6) {
                return `$${(marketCap / 1e6).toFixed(2)}M`;
            } else {
                return `$${formatNumber(marketCap)}`;
            }
        }
        
        // Simulación de API para pruebas (en un entorno real, se reemplazaría con una API financiera)
        async function simulateApiCall(symbol) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    // Lista de símbolos válidos para la demo
                    const validSymbols = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA', 'META'];
                    
                    if (!validSymbols.includes(symbol)) {
                        resolve({ error: 'Símbolo no encontrado. Prueba con AAPL, MSFT, GOOGL, AMZN, TSLA o META' });
                        return;
                    }
                    
                    // Genera datos aleatorios pero realistas para la demo
                    const basePrice = getBasePrice(symbol);
                    const variance = basePrice * 0.02; // 2% de variación
                    const price = basePrice + (Math.random() * variance * 2 - variance);
                    const open = price * (1 + (Math.random() * 0.01 - 0.005));
                    const high = Math.max(price, open) * (1 + Math.random() * 0.01);
                    const low = Math.min(price, open) * (1 - Math.random() * 0.01);
                    const prevClose = price * (1 + (Math.random() * 0.02 - 0.01));
                    const change = price - prevClose;
                    const changePercent = (change / prevClose) * 100;
                    
                    resolve({
                        symbol: symbol,
                        companyName: getCompanyName(symbol),
                        price: price,
                        open: open,
                        high: high,
                        low: low,
                        prevClose: prevClose,
                        change: change,
                        changePercent: changePercent,
                        volume: Math.floor(Math.random() * 10000000) + 5000000,
                        marketCap: getMarketCap(symbol),
                        peRatio: Math.random() * 40 + 10
                    });
                }, 1000); // Simula un retraso de red de 1 segundo
            });